(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1283:function(s,v,t){"use strict";var a=t(870);t.n(a).a},1613:function(s,v,t){"use strict";t.r(v);var a=function(){var s=this.$createElement;this._self._c;return this._m(0)};a._withStripped=!0;t(1283);var _=t(1),e=Object(_.a)({},a,[function(){var s=this,v=s.$createElement,t=s._self._c||v;return t("article",{staticClass:"content post"},[t("h1",{attrs:{id:"浮层管理"}},[s._v("浮层管理")]),s._v(" "),t("p",[s._v("在 VEUI 中，有大量组件使用到了浮层功能：")]),s._v(" "),t("ul",[t("li",[s._v("各种类型的弹框："),t("a",{attrs:{href:"../components/dialog"}},[s._v("对话框")]),s._v("、"),t("a",{attrs:{href:"../components/alert-box"}},[s._v("警告弹框")]),s._v("等；")]),s._v(" "),t("li",[t("a",{attrs:{href:"../components/select"}},[s._v("下拉选择")]),s._v("；")]),s._v(" "),t("li",[s._v("……")])]),s._v(" "),t("p",[s._v("针对这些组件，我们抽离了具备如下功能的浮层模块：")]),s._v(" "),t("ul",[t("li",[s._v("能够浮于页面上所有普通元素之上；")]),s._v(" "),t("li",[s._v("能够进行层叠顺序管理；")]),s._v(" "),t("li",[s._v("能够基于指定元素定位。")])]),s._v(" "),t("h2",{attrs:{id:"层叠覆盖"}},[s._v("层叠覆盖")]),s._v(" "),t("p",[s._v("为了避免浮层被上层 "),t("code",[s._v("overflow: hidden")]),s._v(" 的元素意外遮盖，我们将浮层根元素直接置于 "),t("code",[s._v("<body>")]),s._v(" 下统一管理。")]),s._v(" "),t("p",[s._v("在"),t("a",{attrs:{href:"../components/overlay"}},[s._v("浮层组件")]),s._v("中，"),t("code",[s._v(".veui-overlay-box")]),s._v(" 对应了浮层根元素，该元素在组件初始化的时候，会被放置到 "),t("code",[s._v("<body>")]),s._v(" 之下，组件销毁的时候，会被移除掉。")]),s._v(" "),t("h2",{attrs:{id:"层叠顺序管理"}},[s._v("层叠顺序管理")]),s._v(" "),t("p",[s._v("在将浮层根元素置于 "),t("code",[s._v("<body>")]),s._v(" 下后，原有的层级嵌套关系会丢失，同时也无法通过原生的层叠上下文机制来控制浮层的层叠顺序。比如：")]),s._v(" "),t("ul",[t("li",[s._v("某个对话框组件 A 上有一个下拉选择组件 B，那么 B 组件浮层应该位于 A 组件浮层之上。")]),s._v(" "),t("li",[s._v("警告框浮层应该位于普通对话框浮层之上。")])]),s._v(" "),t("p",[s._v("基于上述限制，浮层模块实现了自己的层叠顺序管理机制。整个浮层层级嵌套关系，是通过一棵树来表达的：")]),s._v(" "),t("figure",{staticClass:"hero"},[t("div",{staticClass:"preview"},[t("img",{staticClass:"hero",attrs:{src:"/images/development/advanced/overlay-tree.png",srcset:"/images/development/advanced/overlay-tree.png 2x"}})])]),s._v(" "),t("p",[s._v("树中每一个蓝色节点都对应关联到具体的"),t("a",{attrs:{href:"../componnets/overlay"}},[s._v("浮层组件")]),s._v("实例。针对上图，树的构造顺序可以是：")]),s._v(" "),t("ol",[t("li",[s._v("弹出“对话框1”，创建一个“对话框1”节点，根据节点权重信息创建一个分组，然后将分组挂在 root 节点之下。")]),s._v(" "),t("li",[s._v("弹出“对话框2”，创建一个“对话框2”节点，发现已经存在相同权重的分组，就直接将“对话框2”节点放置在该分组的末尾位置。")]),s._v(" "),t("li",[s._v("在“对话框2”中实例化一个“下拉选择1”组件实例，由于“对话框2”组件实例是“下拉选择1”组件实例的父级，因此对应的浮层节点也应当具备父子关系，因此按照类似于“步骤1”的顺序在“对话框2”节点下生成分组及“下拉选择1”节点。")]),s._v(" "),t("li",[s._v("此时由于程序运行出现了故障，弹出了“警告弹框1”，由于“警告弹框”类型的组件相对于“对话框”组件具备更高的层级权重，因此在 root 之下新建了一个靠右的分组，并将生成的“警告弹框1”节点置于分组末尾。")])]),s._v(" "),t("p",[s._v("有了树之后，就会按照深度优先的遍历顺序生成每个节点的 "),t("code",[s._v("z-index")]),s._v(" 值。")]),s._v(" "),t("p",[s._v("其中，基准 "),t("code",[s._v("z-index")]),s._v(" 值可以通过全局配置对象进行配置：")]),s._v(" "),t("pre",[t("code",{staticClass:"hljs language-js"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" config "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'veui/managers/config'")]),s._v("\n\nconfig.set("),t("span",{staticClass:"hljs-string"},[s._v("'overlay.baseZIndex'")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("200")]),s._v(")")])]),s._v(" "),t("div",{staticClass:"warning custom-block"},[t("p",[s._v("必须在"),t("a",{attrs:{href:"../components/overlay"}},[s._v("浮层组件")]),s._v("引入之前设置基准 "),t("code",[s._v("z-index")]),s._v("，不然不会生效。")])]),s._v(" "),t("p",[s._v("可以针对组件类型，甚至组件实例粒度设置层叠优先级，层叠优先级值越大，最终生成的 "),t("code",[s._v("z-index")]),s._v(" 值就越大。具有相同层叠优先级的同级组件实例，越靠后实例化的组件，生成的 "),t("code",[s._v("z-index")]),s._v(" 值越大。")]),s._v(" "),t("p",[s._v("浮层组件、对话框组件、弹框组件等提供了 "),t("code",[s._v("priority")]),s._v(" 属性，用于自定义组件实例的层叠优先级：")]),s._v(" "),t("pre",[t("code",{staticClass:"hljs language-html"},[t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("veui-dialog")]),s._v(" "),t("span",{staticClass:"hljs-attr"},[s._v(":priority")]),s._v("="),t("span",{staticClass:"hljs-string"},[s._v('"300"')]),s._v("/>")])])]),s._v(" "),t("p",[s._v("一些比较特殊的组件，会提供基于组件类型粒度的层叠优先级配置：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("组件")]),t("th",[s._v("配置字段")]),t("th",[s._v("默认值")]),t("th",[s._v("修改配置示例")])])]),t("tbody",[t("tr",[t("td",[s._v("警告弹框")]),t("td",[t("code",[s._v("alertbox.priority")])]),t("td",[t("code",[s._v("100")])]),t("td",[t("pre",[t("code",{staticClass:"hljs language-js"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" config "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'veui/managers/config'")]),s._v("\n\nconfig.set("),t("span",{staticClass:"hljs-string"},[s._v("'alertbox.priority'")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("100")]),s._v(")")])])])]),t("tr",[t("td",[s._v("确认弹框")]),t("td",[t("code",[s._v("confirmbox.priority")])]),t("td",[t("code",[s._v("100")])]),t("td",[t("pre",[t("code",{staticClass:"hljs language-js"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" config "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'veui/managers/config'")]),s._v("\n\nconfig.set("),t("span",{staticClass:"hljs-string"},[s._v("'confirmbox.priority'")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("100")]),s._v(")")])])])]),t("tr",[t("td",[s._v("输入弹框")]),t("td",[t("code",[s._v("promptbox.priority")])]),t("td",[t("code",[s._v("100")])]),t("td",[t("pre",[t("code",{staticClass:"hljs language-js"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" config "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'veui/managers/config'")]),s._v("\n\nconfig.set("),t("span",{staticClass:"hljs-string"},[s._v("'promptbox.priority'")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("100")]),s._v(")")])])])])])]),s._v(" "),t("p",[s._v("总结起来，确定某个浮层系组件实例的层叠优先级的逻辑流程为：")]),s._v(" "),t("ul",[t("li",[s._v("如果能够设置组件实例级别的层叠优先级，并且设置了，那么就使用这个层叠优先级值，否则进入下一步；")]),s._v(" "),t("li",[s._v("如果能够设置组件类型级别的层叠优先级，并且设置了，那么就使用这个层叠优先级值，否则进入下一步；")]),s._v(" "),t("li",[s._v("使用默认的层叠优先级值："),t("code",[s._v("1")]),s._v("。")])]),s._v(" "),t("h2",{attrs:{id:"定位"}},[s._v("定位")]),s._v(" "),t("p",[s._v("VEUI 中，浮层支持两种定位方式：")]),s._v(" "),t("ul",[t("li",[s._v("在页面范围内，以坐标值的形式进行定位；")]),s._v(" "),t("li",[s._v("相对于某个元素，指定偏移和变换规则进行定位。")])]),s._v(" "),t("p",[s._v("以坐标方式定位时，需要自己写 CSS 进行控制（浮层模块内部只会生成浮层根元素的 "),t("code",[s._v("z-index")]),s._v(" 值）。")]),s._v(" "),t("p",[s._v("相对元素定位时，可以通过"),t("a",{attrs:{href:"../components/overlay"}},[s._v("浮层组件")]),s._v("的 "),t("code",[s._v("options")]),s._v(" 属性描述偏移和变换规则。由于目前内部采用 "),t("a",{attrs:{href:"http://tether.io/"}},[s._v("Tether")]),s._v(" 实现，因此完整的配置项可以参考 "),t("a",{attrs:{href:"http://tether.io/#options"}},[s._v("Tether 官网")]),s._v("。同时，也支持一些常见场景的简化配置："),t("code",[s._v("{ position: `${side}-${align}` }")]),s._v("，"),t("code",[s._v("side")]),s._v(" 表示浮层根元素位于目标元素哪一边（"),t("code",[s._v("top")]),s._v("/"),t("code",[s._v("right")]),s._v("/"),t("code",[s._v("bottom")]),s._v("/"),t("code",[s._v("left")]),s._v("），"),t("code",[s._v("align")]),s._v(" 表示对齐方式（"),t("code",[s._v("start")]),s._v("/"),t("code",[s._v("end")]),s._v("）。其中 "),t("code",[s._v("side")]),s._v(" 是必须的，"),t("code",[s._v("align")]),s._v(" 不传表示居中。推荐尽量使用简化的配置。")]),s._v(" "),t("h2",{attrs:{id:"样式"}},[s._v("样式")]),s._v(" "),t("p",[s._v("由于浮层根元素被手动放置到 "),t("code",[s._v("<body>")]),s._v(" 元素之下了，要设置浮层内容的样式，就需要给浮层根元素指定 "),t("code",[s._v("class")]),s._v("。所有浮层系组件都支持 "),t("code",[s._v("overlay-class")]),s._v(" 属性，通过该属性为浮层根元素设置 "),t("code",[s._v("class")]),s._v("：")]),s._v(" "),t("pre",[t("code",{staticClass:"hljs language-vue"},[t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("template")]),s._v(">")]),t("span",{staticClass:"html"},[s._v("\n  "),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("veui-dialog")]),s._v(" "),t("span",{staticClass:"hljs-attr"},[s._v("overlay-class")]),s._v("="),t("span",{staticClass:"hljs-string"},[s._v('"my-dialog-overlay"')]),s._v("/>")]),s._v("\n"),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("template")]),s._v(">")]),s._v("\n\n"),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("style")]),s._v(">")]),t("span",{staticClass:"css"},[s._v("\n"),t("span",{staticClass:"hljs-selector-class"},[s._v(".my-dialg-overlay")]),s._v(" {\n  "),t("span",{staticClass:"hljs-comment"},[s._v("/* 自定义浮层样式 */")]),s._v("\n}\n")]),t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-name"},[s._v("style")]),s._v(">")])])])])])}],!1,null,"796cc6fc",null);v.default=e.exports},870:function(s,v,t){}}]);